defaults:
  - ../../../examples/config/traj_envs.yaml@_here_
  - ../../../examples/config/traj_envs_gem_games.yaml@_here_
  - ../../../examples/config/traj_envs_gem_rg.yaml@_here_

rollout_batch_size: 32
sequence_length: 8192
pretrain: Qwen/Qwen2.5-0.5B-Instruct

train_env_manager:
  format_penalty: -0.15 # sokoban env penalty_for_step=-0.1
  max_env_num_per_worker: 1
  num_env_groups: 1
  # under the same group, the env config and env seed are ensured to be equal
  group_size: 1
  tags: [deep_math]
  num_groups_partition: [1] # If not set, all env names divide nums equally. Under the same group, the env config and env seed (prompt) are equal in each generation
  llm_proxy:
    proxy_type: random
#  llm_proxy:
#    proxy_type: openai
#    proxy_config:
#      base_url: https://offline-whale-wave.alibaba-inc.com/api/v2/services/aigc/text-generation/v1/chat/completions
#      api_key: xxx
#      model_name: Qwen2.5-72B-Instruct-Chatflow

custom_envs:
  SimpleSokoban:
    ${custom_env.SimpleSokoban}
  FrozenLake:
    ${custom_env.FrozenLake}
  NaturalQuestions:
    ${custom_env.NaturalQuestions}
  GemGame:
    ${gem_games.Hangman}
  CliEnv:
    ${custom_env.CliEnv}
  deep_math:
    ${custom_env.deep_math}
  CodeContest:
    ${custom_env.CodeContest}
  SweNativeEnv:
    ${custom_env.SweNativeEnv}
  SokobanNativeEnv:
    ${custom_env.SokobanNativeEnv}
  RockTBNativeEnvTrain:
    ${custom_env.RockTBNativeEnvTrain}  

actor_infer:
  generating_args:
    max_new_tokens: ${max_tokens_per_step} # single-turn response length
    top_p: 0.99
    top_k: 100
    num_beams: 1
    temperature: 0.99
    num_return_sequences: 1

max_tokens_per_step: 2048
max_actions_per_traj: 10

env_manager_cls: roll.pipeline.agentic.env_manager.traj_env_manager.TrajEnvManager
custom_env:
  CliEnv:
    env_type: cli
    max_steps: ${max_actions_per_traj}
    max_tokens_per_step: ${max_tokens_per_step}
    env_manager_cls: ${env_manager_cls}
    agent_system_template: ${cli_agent_system_template}
    agent_template: ${cli_agent_template}
    env_config:
      max_steps: ${max_actions_per_traj}
      workspace_dir: /tmp/cli_workspace
      sandbox_image: hub.docker.alibaba-inc.com/chatos/iflow-cli:3.0
      sandbox_base_url: https://xrl-sandbox.alibaba-inc.com
      auto_clear_seconds: 1200
      format_penalty: -0.1
  SimpleSokoban:
    env_type: sokoban
    max_steps: ${max_actions_per_traj}
    max_tokens_per_step: ${max_tokens_per_step}
    env_manager_cls: ${env_manager_cls}
    use_thread_lock: true
    agent_system_template: ${agent_system_template}
    agent_template: ${agent_template}
    env_config: # keys should be a subset of SokobanConfig
      action_pattern: ${all_response_pattern}
      dim_room: [10, 10]
      num_boxes: 1
  FrozenLake:
    env_type: frozen_lake
    max_steps: ${max_actions_per_traj}
    max_tokens_per_step: ${max_tokens_per_step}
    env_manager_cls: ${env_manager_cls}
    use_thread_lock: true
    agent_system_template: ${agent_system_template}
    agent_template: ${agent_template}
    env_config:
      action_pattern: ${all_response_pattern}
      max_steps: ${max_actions_per_traj}
      is_slippery: false
  NaturalQuestions:
    env_type: "qa:NaturalQuestions"
    max_steps: ${max_actions_per_traj}
    max_tokens_per_step: ${max_tokens_per_step}
    env_manager_cls: ${env_manager_cls}
    agent_system_template: ${single_prompt_agent_system_template}
    agent_template: ${single_prompt_agent_template}
    env_config:
      max_steps: 10
      dataset_name: /Users/pan/Downloads/huggingface/NaturalQuestions
    tool_wrapper:
      wrapper_args:
        tool_reward: 0.05
        tool_success_reward: 0.25
        max_tool_uses: 5
      tool_configs:
        - tool_id: search
          tool_args:
            search_url: http://localhost:8000/retrieve
            topk: 3
  deep_math:
    env_type: "roll_math"
    max_steps: ${max_actions_per_traj}
    max_tokens_per_step: ${max_tokens_per_step}
    env_manager_cls: ${env_manager_cls}
    agent_system_template: ${single_prompt_agent_system_template}
    agent_template: ${single_prompt_agent_template}
    env_config:
      dataset_name: data/math_deepmath_deal.jsonl
      split: train
      question_key: prompt
      answer_key: ground_truth
  CodeContest:
    env_type: "code:CodeContest"
    max_steps: ${max_actions_per_traj}
    max_tokens_per_step: ${max_tokens_per_step}
    env_manager_cls: ${env_manager_cls}
    agent_system_template: ${single_prompt_agent_system_template}
    agent_template: ${single_prompt_agent_template}
    env_config:
      max_steps: 10
      dataset_name: CodeContest
    tool_wrapper:
      wrapper_args:
        tool_reward: 0.05
        tool_success_reward: 0.25
        max_tool_uses: 5
      tool_configs:
        - tool_id: python_code
          tool_args:
            timeout: 5
            sandbox_type: none
            keep_error_last_line: false
  SweNativeEnv:
    env_type: "swe_native_env"
    max_steps: 10
    max_tokens_per_step: 8192
    env_manager_cls: roll.pipeline.agentic.env_manager.agent_native_env_manager.AgentNativeStepEnvManager
    agent_system_template: "agent_system_template placeholder"
    agent_template: "agent_template placeholder"
    env_config:
      dataset_name: data/swe/data.jsonl
      train_idx_range: [1, 1]
      val_idx_range: [0, 0]
      tools: [ "Edit", "glob", "list_directory", "read_file", "Shell" ]
      traj_dir: "./traj/trainset/"
      swe_requirement_dir: ""
      base_dir: "./logs"

      max_steps: 5
      mode: "train"
      xrl_authorization: t-r8c4rjh0por8gwc5
      sandbox_base_url: https://xrl-sandbox.alibaba-inc.com
      user_id: '410435'
      experiment_id: "test"

  SokobanNativeEnv:
    env_type: "sokoban_native_env"
    max_steps: 10
    max_tokens_per_step: 128
    env_manager_cls: roll.pipeline.agentic.env_manager.agent_native_env_manager.AgentNativeStepEnvManager
    agent_system_template: "agent_system_template placeholder"
    agent_template: "agent_template placeholder"
    env_config:
      max_steps: 10

  RockTBNativeEnvTrain:
    env_type: "rock_tb_native_env"
    max_steps: 10
    max_tokens_per_step: 8192
    env_manager_cls: roll.pipeline.agentic.env_manager.agent_native_env_manager.AgentNativeStepEnvManager
    agent_system_template: "agent_system_template placeholder"
    agent_template: "agent_template placeholder"
    env_config:
      dataset_name: data/terminal_bench.jsonl
      train_idx_range: [13, 13]
      tools: ~
      max_steps: 10
      mode: "train"
      xrl_authorization: t-j99eljub5bst4q9p
      sandbox_base_url: https://xrl-sandbox.alibaba-inc.com
      user_id: '481404'
      experiment_id: "test"
      test_files: ["output/terminal-bench/terminal-bench"]
      agent_config:
        agent_type: "iflow-cli"
        version: "0.0.1"
        pre_init_bash_cmd_list:
          - command: 'echo "118.31.38.66 github.com" | tee -a /etc/hosts'
            timeout_seconds: 30
          - command: "apt-get update"
            timeout_seconds: 600
          - command: "apt-get install -y curl git wget xz-utils"
            timeout_seconds: 600
          - command: "apt-get install -y build-essential libc6-dev patch procps"
            timeout_seconds: 600
        model_service_config: 
          model_service_install_cmd: 'pip install "rl_rock[model-service]==1.0.0" -i https://artlab.alibaba-inc.com/1/pypi/simple --trusted-host artlab.alibaba-inc.com'
        iflow_cli_install_cmd: "wget --retry-connrefused --tries=10 --waitretry=2 -O ~/iflow-cli.tgz 'http://cloud.iflow.cn/iflow-cli/iflow-ai-iflow-cli-for-roll-0-4-4-v5.tgz' && npm i -g ~/iflow-cli.tgz && ln -s /opt/nodejs/bin/iflow /usr/local/bin/iflow"
        iflow_settings:
          selectedAuthType: "openai-compatible"
          apiKey: "123"
          baseUrl: "http://127.0.0.1:8080/v1/"
          modelName: "Qwen3-Coder-Plus"
          searchApiKey: "88888888"
          disableAutoUpdate: True
          shellTimeout: 360000
          tokensLimit: 128000          
          coreTools: [
                    "Edit",
                    "exit_plan_mode",
                    "glob",
                    "list_directory",
                    "multi_edit",
                    "plan",
                    "read plan",
                    "read_file",
                    "read_many_files",
                    "save_memory",
                    "Search",
                    "Shell",
                    "task",
                    "web_fetch",
                    "web_search",
                    "write_file",
                    "xml_escape",
                  ]    

cli_agent_system_template: You're a helpful assistant. You are a good game player. You are aiming to get high reward in the game.
cli_agent_template: |
  {observation}
  Strictly follow this format:
  1. output format is '<answer> [your answer] </answer>' with no extra text. 
  2. You have {actions_left} actions left. 
  3. Max response length: {max_response_length} words (tokens).
  Decide the next action:
